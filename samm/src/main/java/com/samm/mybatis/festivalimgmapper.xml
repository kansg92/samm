<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org/DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.samm.mapper.FestivalImgMapper">

	<insert id="insert" parameterType="Map">
		INSERT INTO festivalimg VALUES (NULL,#{name},default,#{fid},#{uid},now())
	</insert>	
	
	<select id="selectAll" resultType="FestivalImgVo">
		SELECT * FROM festivalimg 
	</select>
	
	<select id="selectAllFid" parameterType="int" resultType="FestivalImgVo">
		SELECT * FROM festivalimg WHERE fid=#{fid} 
	</select>
	
	<select id="selectAllowY" parameterType="int" resultType="FestivalImgVo">
		SELECT * FROM festivalimg WHERE fid=#{fid} AND allowYN = 'Y'
	</select>
	
	<update id="updateAllow" parameterType="FestivalImgVo">
		UPDATE festivalimg SET allowYN=#{allowYN}
	</update>

	<select id="selectByUid" parameterType="String" resultType="FestivalImgVo">
		SELECT * FROM festivalimg fi
		INNER JOIN festival f ON fi.fid = f.contentid
		WHERE uid=#{uid}
	</select>




	<update id="updateYN" parameterType="int">
		UPDATE festivalimg SET allowYN='Y' 
		WHERE id=#{id}
	</update>
 
	<delete id="deleteNew" parameterType="int">
		DELETE FROM festivalimg WHERE id=#{id}
	</delete>

	<select id="selectAllNew" resultType="imgallowVo">
		SELECT i.id as iid, i.uid as uid, u.name as uname, 
			   f.title as ftitle, i.regdate as imgregdate, 
			   i.name as imgname
		FROM festivalimg i join festival f join users u
		on i.fid = f.contentid and u.id = i.uid 
		where i.allowYN = 'N'
	</select>

	<select id="selectNew" parameterType="int" resultType="imgallowVo">
		SELECT i.id as iid, i.uid as uid, u.name as uname, 
			   f.title as ftitle, i.regdate as imgregdate, 
			   i.name as imgname
		FROM festivalimg i join festival f join users u
		on i.fid = f.contentid and u.id = i.uid 
		where i.id=#{iid}
	</select>
	
	
	

</mapper>
	
	